"use strict";!function(){function e(t,i,e){this.callback=i,this.name=t,this.init=function(){e.querySelector(".audio-playlist-controls button."+this.name).addEventListener("click",this.callback)},this.init()}function s(t){this.audioElems,this.buttons=[],this.currentTrack,this.elem=t,this.id,this.isPaused=0,this.isPlaying=0,this.isRepeat=0,this.nextTrack,this.playButton,this.playlistLength,this.previousTrack,this.initCurrentDisplay=function(){this.currentTitleElem=t.querySelector(".current-track-info .title"),this.currentTimeTotalElem=t.querySelector(".current-track-info .playtime .total"),this.currentTimeElem=t.querySelector(".current-track-info .playtime .current")},this.init=function(t){this.id=t.dataset.playlistId,this.audioElems=t.querySelectorAll("audio"),this.audioElems.length&&(this.playlistLength=this.audioElems.length,this.resetPlaylist(),[{name:"play",callback:this.playAudio.bind(this)},{name:"pause",callback:this.pauseAudio.bind(this)},{name:"stop",callback:this.stopAudio.bind(this)},{name:"next",callback:this.playNext.bind(this)},{name:"previous",callback:this.playPrevious.bind(this)},{name:"repeat",callback:this.toggleRepeat.bind(this)}].forEach(function(t,i){this.buttons.push(new e(t.name,t.callback,this.elem))},this),t.querySelectorAll(".audio-playlist-item").forEach(function(t,i){t.addEventListener("click",this.selectManual.bind(this))},this),this.initCurrentDisplay())},this.pauseAudio=function(){this.isPlaying?(this.isPlaying=0,this.isPaused=1,this.audioElems[this.currentTrack-1].pause(),t.querySelector(".audio-playlist-controls button.pause").classList.add("active"),t.querySelector(".audio-playlist-controls button.play").classList.remove("active")):this.isPaused&&(this.isPlaying=0,this.isPaused=1,this.audioElems[this.currentTrack-1].pause(),this.playAudio())},this.playAudio=function(){this.isPlaying&&!this.isPaused||(this.isPlaying=1,this.audioElems[this.currentTrack-1].play(),this.isPaused||this.audioElems[this.currentTrack-1].parentNode.classList.toggle("active"),this.isPaused=0,this.updateCurrentDisplay(),this.audioElems[this.currentTrack-1].addEventListener("timeupdate",this.updateCurrentTimeDisplay.bind(this)),this.audioElems[this.currentTrack-1].addEventListener("ended",this.updateOnAudioEnded.bind(this)),t.querySelector(".audio-playlist-controls button.play").classList.add("active"),t.querySelector(".audio-playlist-controls button.pause").classList.remove("active"))},this.playNext=function(){(this.isPlaying||this.isPaused&&this.nextTrack)&&(this.isPlaying=0,this.isPaused=0,this.audioElems[this.currentTrack-1].pause(),this.audioElems[this.currentTrack-1].currentTime=0,this.audioElems[this.currentTrack-1].removeEventListener("timeupdate",this.updateCurrentTimeDisplay.bind(this)),this.audioElems[this.currentTrack-1].removeEventListener("ended",this.updateOnAudioEnded.bind(this)),this.currentTrack=this.nextTrack,this.setNextTrack(),this.setPreviousTrack(),this.audioElems[this.previousTrack-1].parentNode.classList.remove("active"),this.playAudio())},this.playPrevious=function(){(this.isPlaying||this.isPaused&&this.previousTrack)&&(this.isPlaying=0,this.isPaused=0,this.audioElems[this.currentTrack-1].pause(),this.audioElems[this.currentTrack-1].currentTime=0,this.audioElems[this.currentTrack-1].removeEventListener("timeupdate",this.updateCurrentTimeDisplay.bind(this)),this.audioElems[this.currentTrack-1].removeEventListener("ended",this.updateOnAudioEnded.bind(this)),this.currentTrack=this.previousTrack,this.setNextTrack(),this.setPreviousTrack(),this.audioElems[this.nextTrack-1].parentNode.classList.remove("active"),this.playAudio())},this.resetPlaylist=function(){this.currentTrack=1,this.setNextTrack(),this.setPreviousTrack()},this.selectManual=function(t){this.isPlaying&&this.pauseAudio(),this.isPaused&&(this.isPaused=0,this.audioElems[this.currentTrack-1].currentTime=0,this.audioElems[this.currentTrack-1].parentNode.classList.remove("active")),this.currentTrack=parseInt(function t(i,e){return void 0===i.parentNode?(console.error("No parentNode found.",i),!1):0<=i.parentNode.classList.toString().indexOf(e)?i.parentNode:t(i.parentNode,e)}(t.target,"audio-playlist-item").dataset.itemIndex),this.setNextTrack(),this.setPreviousTrack(),this.playAudio()},this.setNextTrack=function(){this.playlistLength>this.currentTrack?this.nextTrack=this.currentTrack+1:this.nextTrack=0},this.setPreviousTrack=function(){this.previousTrack=this.currentTrack-1},this.stopAudio=function(){(this.isPlaying||this.isPaused)&&(this.isPlaying=0,this.isPaused=0,this.audioElems[this.currentTrack-1].pause(),this.audioElems[this.currentTrack-1].currentTime=0,this.audioElems[this.currentTrack-1].removeEventListener("timeupdate",this.updateCurrentTimeDisplay.bind(this)),this.audioElems[this.currentTrack-1].removeEventListener("ended",this.updateOnAudioEnded.bind(this)),this.audioElems[this.currentTrack-1].parentNode.classList.toggle("active"),this.updateCurrentDisplay(),this.resetPlaylist(),t.querySelector(".audio-playlist-controls button.play").classList.remove("active"),t.querySelector(".audio-playlist-controls button.pause").classList.remove("active"))},this.toggleRepeat=function(){this.isRepeat=1^this.isRepeat,t.querySelector(".audio-playlist-controls button.repeat").classList.toggle("active")},this.updateCurrentDisplay=function(){this.isPlaying?(this.currentTitle=this.audioElems[this.currentTrack-1].parentNode.querySelector(".tag-info .title").innerText,this.currentTimeTotal=this.audioElems[this.currentTrack-1].parentNode.querySelector(".tag-info .playtime").innerText,2==this.currentTimeTotal.length&&(this.currentTimeTotal="00:"+this.currentTimeTotal),4==this.currentTimeTotal.length&&(this.currentTimeTotal="0"+this.currentTimeTotal)):(this.currentTitle="",this.currentTimeTotal="00:00"),this.currentTitleElem.innerText=this.currentTitle,this.currentTimeTotalElem.innerText=this.currentTimeTotal},this.updateCurrentTimeDisplay=function(){var t,i,e;this.currentTimeElem.innerText=(t=this.audioElems[this.currentTrack-1].currentTime,i=Math.floor(t/3600),e=Math.floor((t-3600*i)/60),t=Math.floor(t-3600*i-60*e),(e=e<10?"0"+e:e)+":"+(t=t<10?"0"+t:t))},this.updateOnAudioEnded=function(){this.nextTrack?this.playNext():(this.stopAudio(),this.isRepeat&&this.playAudio())},this.init(t)}var t=document.querySelectorAll(".jw-audio-playlist"),a=[];t.forEach(function(t,i){a.push(new s(t))})}(window);